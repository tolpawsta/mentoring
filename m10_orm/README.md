# Задания к модулю ORM.

# Task 1 Micro-ORM

## Общие моменты

Для выполнения данного задания используется база Northwind и одной из Micro-ORM (Dapper, linq2db, … - я рекомендую остановиться на linq2db).

## Задание 1

Создать объектную модель и описать маппинг для таблиц базы Northwind. Особое внимание обратить на:

- Задание первичных ключей
- Описание связей между сущностями и реализации отношений 1-М, М-М

## Задание 2

Продемонстрировать следующие запросы:

- Список продуктов с категорией и поставщиком
- Список сотрудников с указанием региона, за который они отвечают
- Статистики по регионам: количества сотрудников по регионам
- Списка «сотрудник – с какими грузоперевозчиками работал» (на основе заказов)

## Задание 3

Продемонстрировать внесение изменений:

- Добавить нового сотрудника, и указать ему список территорий, за которые он несет ответственность.
- Перенести продукты из одной категории в другую
- Добавить список продуктов со своими поставщиками и категориями (массовое занесение), при этом если поставщик или категория с таким названием есть, то использовать их – иначе создать новые.
- Замена продукта на аналогичный: во всех еще неисполненных заказах (считать таковыми заказы, у которых `ShippedDate = NULL`) заменить один продукт на другой.

# Task 2 EntityFramework

## Задание 1. Генерация модели

Сгенерируйте модель для Northwind используя подход `EF Code First`.
Для проверки работоспособности приведите пример запроса:

- Выборка списка заказов, по одной категории (т.е. те заказы, в которые включены продукты определенной категории)
- Выборка должна включать
  - Список детальных строк
  - Имя заказчика
  - Имена продуктов

## Задание 2. Развертывание и обновление

Для созданной модели включите механизм миграции и создайте 3 версии базы:

- **Версия 1.0**. Основана на оригинальной базе Northwind
- **Версия 1.1**. Добавляет таблицу данных кредитных карт сотрудников: номер карты, дата истечения, имя card holder, ссылку на сотрудника, …
- **Версия 1.3**. Добавляет следующие минорные изменения относительно 1.1:
  - Переименование `Region в Regions`
  - Добавление в таблицу клиентов даты основания

## Задание 3. Загрузка справочников

Добавьте в первоначальную инициализацию базы Northwind (например, используя миграцию, а конкретно `DbMigrationsConfiguration<TContext>.Seed()`, а также метод `DbSetMigrationsExtensions.AddOrUpdate()`) следующие справочники:

- `Category`
- `Region`
- `Territory`

Проверьте работоспособность решения на сценариях:

- Создание базы с 0
- Обновление базы с добавлением и изменением отдельных записей справочников
- Обновление базы, в которой часть записей уже были изменены
